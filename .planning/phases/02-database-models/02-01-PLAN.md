---
phase: 02-database-models
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [prisma/schema.prisma]
autonomous: true
---

<objective>
Define complete database schema with User, Exercise, Session, and Program models including all relationships.

Purpose: Establish the data foundation for the SportPlan platform, enabling user management and the core content hierarchy (Exercise → Session → Program).
Output: Complete Prisma schema with all models, relations, and working migrations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-02-SUMMARY.md

@prisma/schema.prisma
@src/lib/db.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define User and Exercise models</name>
  <files>prisma/schema.prisma</files>
  <action>
Add User model with fields:
- id: String @id @default(cuid())
- email: String @unique
- name: String?
- passwordHash: String (for future auth)
- createdAt: DateTime @default(now())
- updatedAt: DateTime @updatedAt
- Relation: programs Program[]
- Relation: sessions Session[]

Add Exercise model with fields:
- id: String @id @default(cuid())
- name: String
- description: String?
- sport: String (e.g., "running", "swimming", "strength")
- createdAt: DateTime @default(now())
- updatedAt: DateTime @updatedAt
- Relation: sessionExercises SessionExercise[]

Keep existing generator and datasource blocks unchanged. Use SQLite-compatible types only.
  </action>
  <verify>npx prisma validate</verify>
  <done>User and Exercise models defined with proper fields and relations</done>
</task>

<task type="auto">
  <name>Task 2: Define Session model with Exercise junction</name>
  <files>prisma/schema.prisma</files>
  <action>
Add Session model with fields:
- id: String @id @default(cuid())
- name: String
- description: String?
- sport: String
- estimatedDuration: Int? (minutes)
- createdAt: DateTime @default(now())
- updatedAt: DateTime @updatedAt
- authorId: String
- Relation: author User @relation(fields: [authorId], references: [id])
- Relation: exercises SessionExercise[]
- Relation: programSessions ProgramSession[]

Add SessionExercise junction table for Session↔Exercise many-to-many with ordering:
- id: String @id @default(cuid())
- sessionId: String
- exerciseId: String
- order: Int @default(0)
- sets: Int?
- reps: Int?
- duration: Int? (seconds)
- distance: Int? (meters)
- intensity: String? (e.g., "easy", "moderate", "hard", "max")
- notes: String?
- Relation: session Session @relation(fields: [sessionId], references: [id], onDelete: Cascade)
- Relation: exercise Exercise @relation(fields: [exerciseId], references: [id])
- @@unique([sessionId, exerciseId])

The junction table allows the same exercise to be used in multiple sessions with different parameters (sets, reps, duration, etc.).
  </action>
  <verify>npx prisma validate</verify>
  <done>Session and SessionExercise models defined with proper relations</done>
</task>

<task type="auto">
  <name>Task 3: Define Program model with Session junction and run migration</name>
  <files>prisma/schema.prisma</files>
  <action>
Add Program model with fields:
- id: String @id @default(cuid())
- name: String
- description: String?
- sport: String
- durationWeeks: Int (total weeks)
- difficulty: String? (e.g., "beginner", "intermediate", "advanced")
- isPublic: Boolean @default(false)
- createdAt: DateTime @default(now())
- updatedAt: DateTime @updatedAt
- authorId: String
- Relation: author User @relation(fields: [authorId], references: [id])
- Relation: programSessions ProgramSession[]

Add ProgramSession junction table for Program↔Session many-to-many with scheduling:
- id: String @id @default(cuid())
- programId: String
- sessionId: String
- weekNumber: Int (1-based week in program)
- dayOfWeek: Int (1-7, Monday=1)
- order: Int @default(0) (multiple sessions same day)
- Relation: program Program @relation(fields: [programId], references: [id], onDelete: Cascade)
- Relation: session Session @relation(fields: [sessionId], references: [id])
- @@unique([programId, sessionId, weekNumber, dayOfWeek])

After schema is complete, run:
1. npx prisma generate (regenerate client)
2. npx prisma db push (apply schema to database - development mode)
  </action>
  <verify>npx prisma generate && npx prisma db push && npx prisma studio (open briefly to verify tables exist, then close)</verify>
  <done>Program and ProgramSession models defined, Prisma client regenerated, database schema applied</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx prisma validate` passes
- [ ] `npx prisma generate` succeeds
- [ ] `npx prisma db push` applies schema without errors
- [ ] `npm run build` succeeds (TypeScript compiles with new types)
- [ ] All 5 tables exist: User, Exercise, Session, SessionExercise, Program, ProgramSession
</verification>

<success_criteria>

- All models defined (User, Exercise, Session, SessionExercise, Program, ProgramSession)
- All relations properly configured with foreign keys
- Junction tables support the content hierarchy: Exercise → Session → Program
- Prisma client regenerated with new types
- Database schema applied successfully
- Build passes
  </success_criteria>

<output>
After completion, create `.planning/phases/02-database-models/02-01-SUMMARY.md`
</output>

---
phase: 09-social-features
plan: 02
type: execute
wave: 1
depends_on: [09-01]
files_modified: [src/components/LikeButton.tsx, src/components/CommentSection.tsx, src/components/ActivityCard.tsx, src/app/feed/page.tsx, src/app/feed/FeedList.tsx, src/app/programs/[id]/page.tsx, src/app/sessions/[id]/page.tsx]
autonomous: false
---

<objective>
Create social UI components: like buttons, comment sections, and activity feed page.

Purpose: Enable users to interact with programs and sessions through likes and comments, and view an activity feed of followed users.
Output: Reusable social components + /feed page with activity stream
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/components/FollowButton.tsx
@src/components/ProgramCard.tsx
@src/app/programs/[id]/page.tsx
@src/app/discover/DiscoverTabs.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LikeButton component</name>
  <files>src/components/LikeButton.tsx</files>
  <action>
Create a reusable client component for liking programs and sessions.

Props:
- type: "program" | "session"
- targetId: string (program or session ID)
- initialIsLiked: boolean
- initialLikesCount: number
- onLikeChange?: (isLiked: boolean, count: number) => void

Features:
- Heart icon (filled when liked, outline when not)
- Displays like count next to icon
- Optimistic update (update UI immediately, revert on error)
- Loading state during API call
- Disabled state when not authenticated (show login prompt on click)
- Tailwind styling matching FollowButton patterns

API calls:
- POST /api/{programs|sessions}/[id]/like to like
- DELETE /api/{programs|sessions}/[id]/like to unlike

Use similar patterns to FollowButton.tsx for state management.
  </action>
  <verify>Component renders with correct state, handles click events</verify>
  <done>LikeButton component handles like/unlike with optimistic updates</done>
</task>

<task type="auto">
  <name>Task 2: Create CommentSection component</name>
  <files>src/components/CommentSection.tsx</files>
  <action>
Create a client component for displaying and adding comments.

Props:
- type: "program" | "session"
- targetId: string
- currentUserId?: string (null if not logged in)

Features:
- List of comments with user avatar, name, content, timestamp
- Comment form (textarea + submit button) - only shown if logged in
- Login prompt if not logged in
- Delete button on own comments (or if user owns the program/session)
- Edit button on own comments (inline editing)
- Pagination with "Load more" button
- Real-time update after posting (add to top of list)
- Empty state: "Aucun commentaire. Soyez le premier!"
- Character count (max 1000)

State:
- comments array
- loading boolean
- hasMore boolean
- newComment string
- editingId (comment being edited)

API calls:
- GET /api/{programs|sessions}/[id]/comments
- POST /api/{programs|sessions}/[id]/comments
- DELETE /api/comments/[id]
- PATCH /api/comments/[id]

Styling:
- Comment cards with avatar, name, date, content
- Textarea with border, focus ring
- Submit button matching existing buttons
  </action>
  <verify>Component loads comments, allows posting/editing/deleting</verify>
  <done>CommentSection displays comments with full CRUD functionality</done>
</task>

<task type="auto">
  <name>Task 3: Create ActivityCard component</name>
  <files>src/components/ActivityCard.tsx</files>
  <action>
Create a component for displaying a single activity in the feed.

Props:
- activity: Activity object with user, program?, session?, targetUser?, type, createdAt

Display format based on activity type:
- like_program: "[User] a aime le programme [Program]"
- like_session: "[User] a aime la seance [Session]"
- comment_program: "[User] a commente le programme [Program]"
- comment_session: "[User] a commente la seance [Session]"
- create_program: "[User] a cree le programme [Program]"
- create_session: "[User] a cree la seance [Session]"
- follow: "[User] suit maintenant [TargetUser]"

Features:
- User avatar and name (link to profile)
- Activity icon based on type (heart for like, comment bubble, plus for create, user for follow)
- Link to program/session if applicable
- Relative timestamp (il y a 5 min, hier, etc.)
- Sport badge on program/session activities
- Card styling with subtle border, hover effect

Use date-fns or similar for relative time formatting (or implement simple helper).
  </action>
  <verify>Component renders different activity types correctly</verify>
  <done>ActivityCard displays all activity types with proper formatting and links</done>
</task>

<task type="auto">
  <name>Task 4: Create FeedList client component</name>
  <files>src/app/feed/FeedList.tsx</files>
  <action>
Create client component for the activity feed with infinite scroll.

Features:
- Fetches from /api/feed on mount
- Displays ActivityCard for each activity
- Loading skeleton while fetching
- "Load more" button at bottom (or infinite scroll)
- Empty state: "Votre feed est vide. Suivez des utilisateurs pour voir leur activite!"
- Link to /discover to find users to follow
- Error handling with retry button

State:
- activities array
- loading boolean
- page number
- hasMore boolean

Pagination:
- Initial load: page 1
- Load more: increment page, append to activities
  </action>
  <verify>Component fetches and displays paginated activities</verify>
  <done>FeedList displays paginated activity feed with load more</done>
</task>

<task type="auto">
  <name>Task 5: Create feed page</name>
  <files>src/app/feed/page.tsx</files>
  <action>
Create the /feed page as a protected route.

Structure:
- Redirect to login if not authenticated (use auth() and redirect)
- Header with title "Mon Feed" and subtitle
- FeedList component

Layout:
- max-w-3xl container (narrower for feed readability)
- Consistent padding matching other pages

Metadata:
- title: "Feed | SportPlan"
  </action>
  <verify>Page redirects if not logged in, shows feed when logged in</verify>
  <done>Feed page displays authenticated user's activity feed</done>
</task>

<task type="auto">
  <name>Task 6: Integrate social components into program detail page</name>
  <files>src/app/programs/[id]/page.tsx</files>
  <action>
Add LikeButton and CommentSection to the program detail page.

Changes:
- Fetch like status and count for the program (add to existing query or separate query)
- Add LikeButton below program header (next to edit button if owner, or standalone)
- Add CommentSection below program content
- Pass currentUserId from session to CommentSection
- Only show like/comment on public programs (or if owner)

Layout:
- Like button with count in header area
- Comments section at bottom with clear heading "Commentaires"
  </action>
  <verify>Program page shows like button and comments section</verify>
  <done>Program detail page includes social interactions</done>
</task>

<task type="auto">
  <name>Task 7: Integrate social components into session detail page</name>
  <files>src/app/sessions/[id]/page.tsx</files>
  <action>
Add LikeButton and CommentSection to the session detail page.

Same pattern as program page:
- Fetch like status and count
- Add LikeButton in header area
- Add CommentSection at bottom
- Only show for sessions from public users (or if owner)
  </action>
  <verify>Session page shows like button and comments section</verify>
  <done>Session detail page includes social interactions</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete social features UI: likes, comments, and activity feed</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Login with a test account
    3. Go to a public program, verify:
       - Like button appears and works (heart fills on click)
       - Like count updates
       - Comment section appears
       - Can post a comment
       - Can edit/delete own comment
    4. Go to a public session, verify same like/comment functionality
    5. Go to /feed:
       - If following users with activity, see their activities
       - If not following anyone, see empty state with link to discover
    6. Test activity tracking:
       - Like something, check if it appears in another user's feed
       - Comment on something, check feed
    7. Test responsive layout on mobile
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] LikeButton works on programs and sessions
- [ ] CommentSection supports add/edit/delete
- [ ] Feed page shows activities from followed users
- [ ] All components handle loading and error states
- [ ] Responsive design works on mobile
- [ ] User approved visual verification
</verification>

<success_criteria>
- All tasks completed
- Social UI components fully functional
- Activity feed displays followed users' activities
- User approved the implementation
</success_criteria>

<output>
After completion, create `.planning/phases/09-social-features/09-02-SUMMARY.md`
</output>

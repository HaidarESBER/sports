---
phase: 04-sessions-core
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified: [src/app/sessions/page.tsx, src/app/sessions/new/page.tsx, src/app/sessions/[id]/page.tsx, src/app/sessions/[id]/edit/page.tsx, src/components/SessionCard.tsx, src/components/ExerciseSelector.tsx]
autonomous: false
---

<objective>
Create Session UI pages for listing, creating, viewing, and editing sessions.

Purpose: Provide user interface for session management with exercise composition.
Output: Complete session CRUD UI at /sessions routes with exercise management.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-sessions-core/04-01-SUMMARY.md

@prisma/schema.prisma
@src/lib/auth.ts
@src/app/api/sessions/route.ts
@src/app/api/exercises/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Sessions list page and SessionCard component</name>
  <files>src/app/sessions/page.tsx, src/components/SessionCard.tsx</files>
  <action>
**Create src/components/SessionCard.tsx**
Client component ("use client") displaying a session preview:
- Props: { session: Session & { exercises: SessionExercise[] } }
- Show: name, sport badge, estimatedDuration, exercise count
- Link to /sessions/[id] for details
- Edit button linking to /sessions/[id]/edit
- Delete button with confirmation (calls DELETE /api/sessions/[id])
- Tailwind styling: card layout, hover effects

**Create src/app/sessions/page.tsx**
Server component that:
1. Get auth session via `auth()` from @/lib/auth
2. If not authenticated, redirect to /login
3. Fetch sessions from /api/sessions (or use Prisma directly since server component)
4. Render page with:
   - Header "Mes Séances" with "Nouvelle séance" button -> /sessions/new
   - Sport filter tabs (All, Running, Swimming, Strength, etc.)
   - Grid of SessionCard components
   - Empty state if no sessions: "Aucune séance. Créez votre première séance!"

Use Next.js redirect() for auth redirect. For data fetching in server component, use prisma directly:
```typescript
const sessions = await prisma.session.findMany({
  where: { authorId: session.user.id },
  include: { exercises: { include: { exercise: true } } },
  orderBy: { updatedAt: 'desc' }
})
```
  </action>
  <verify>
- `npm run build` succeeds
- /sessions page renders for authenticated user
- Sessions displayed in grid layout
- Sport filter tabs functional
  </verify>
  <done>Sessions list page displays user's sessions with filtering and management actions</done>
</task>

<task type="auto">
  <name>Task 2: Create Session create/edit form with ExerciseSelector</name>
  <files>src/app/sessions/new/page.tsx, src/app/sessions/[id]/edit/page.tsx, src/components/ExerciseSelector.tsx</files>
  <action>
**Create src/components/ExerciseSelector.tsx**
Client component for adding exercises to a session:
- Props: { selectedExercises: SessionExerciseInput[], onExercisesChange: (exercises) => void }
- Search input that fetches /api/exercises?search=query&sport=sport
- Results dropdown showing matching exercises
- Click to add exercise to selected list
- Selected exercises list showing:
  - Exercise name
  - Parameter inputs: sets, reps, duration, distance, intensity (based on exercise type)
  - Drag handle for reordering (optional: use simple up/down arrows)
  - Remove button
- Use useState for search, useEffect for debounced API calls

**Create src/app/sessions/new/page.tsx**
Page for creating a new session:
1. Check auth, redirect if not logged in
2. Form with:
   - Name input (required)
   - Description textarea
   - Sport select (running, swimming, cycling, strength, other)
   - Estimated duration input (minutes)
   - ExerciseSelector component
3. Submit button that POSTs to /api/sessions with exercises
4. On success, redirect to /sessions/[id]
5. Error handling for validation

**Create src/app/sessions/[id]/edit/page.tsx**
Edit page similar to create:
1. Load existing session data
2. Pre-fill form with session data
3. Pre-fill ExerciseSelector with existing exercises
4. Submit PUTs to /api/sessions/[id]
5. Cancel button returns to /sessions/[id]

Use "use client" for forms. Share form component or duplicate with slight variations.
  </action>
  <verify>
- `npm run build` succeeds
- /sessions/new renders create form
- /sessions/[id]/edit loads existing session
- ExerciseSelector searches and adds exercises
  </verify>
  <done>Session create and edit forms work with exercise composition</done>
</task>

<task type="auto">
  <name>Task 3: Create Session detail page</name>
  <files>src/app/sessions/[id]/page.tsx</files>
  <action>
Create session detail view at /sessions/[id]:

1. Server component that:
   - Gets session by id with exercises included
   - Verifies user is author (redirect to /sessions if not)
   - Shows 404 page if session not found

2. Display:
   - Session name as heading
   - Sport badge
   - Description (if exists)
   - Estimated duration (if exists)
   - Created/updated timestamps
   - Action buttons: Edit, Delete

3. Exercises section:
   - "Exercices" subheading with count
   - Ordered list of exercises with parameters:
     - Exercise name
     - Parameters in chips: "3x10" (sets x reps), "5min", "1000m", intensity badge
   - Empty state if no exercises

4. Delete button:
   - Confirmation modal or inline confirm
   - Calls DELETE /api/sessions/[id]
   - Redirects to /sessions on success

Style with Tailwind: clean layout, good typography hierarchy, responsive.
  </action>
  <verify>
- `npm run build` succeeds
- /sessions/[id] displays session details
- Exercises shown with parameters
- Edit and Delete actions work
  </verify>
  <done>Session detail page shows full session info with exercises and actions</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Sessions CRUD UI with exercise management</what-built>
  <how-to-verify>
1. Run: `npm run dev`
2. Login at /login (create account if needed at /register)
3. Visit: http://localhost:3000/sessions
4. Check sessions list:
   - Empty state shows if no sessions
   - "Nouvelle séance" button visible
5. Create a session:
   - Click "Nouvelle séance" -> /sessions/new
   - Fill form: name, sport, description, duration
   - Search and add 2-3 exercises
   - Configure exercise parameters (sets, reps, etc.)
   - Submit -> should redirect to detail page
6. View session detail:
   - Session info displayed correctly
   - Exercises listed with parameters
7. Edit session:
   - Click Edit -> /sessions/[id]/edit
   - Modify name, add/remove exercises
   - Save -> returns to detail
8. Delete session:
   - Click Delete, confirm
   - Session removed, redirected to /sessions
9. Check responsive layout on mobile viewport

Note: If auth UI (03-02) not complete, test API directly with curl and session cookie.
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] /sessions page lists user's sessions
- [ ] Sport filter tabs work
- [ ] /sessions/new creates new session with exercises
- [ ] /sessions/[id] shows session detail with exercises
- [ ] /sessions/[id]/edit updates session
- [ ] Delete removes session
- [ ] Visual verification passed
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verified UI works correctly
- Complete session CRUD flow functional
</success_criteria>

<output>
After completion, create `.planning/phases/04-sessions-core/04-02-SUMMARY.md`
</output>

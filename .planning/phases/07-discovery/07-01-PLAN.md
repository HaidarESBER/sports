---
phase: 07-discovery
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/app/api/discover/programs/route.ts, src/app/api/discover/sessions/route.ts, src/app/api/discover/users/route.ts]
autonomous: true
---

<objective>
Create public discovery API endpoints for searching and filtering programs, sessions, and users.

Purpose: Enable discovery of public content with search, filters, and pagination - following established API patterns.
Output: Three API endpoints: /api/discover/programs, /api/discover/sessions, /api/discover/users
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@prisma/schema.prisma
@src/app/api/exercises/route.ts
@src/app/api/users/[id]/followers/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create programs discovery endpoint</name>
  <files>src/app/api/discover/programs/route.ts</files>
  <action>
Create GET /api/discover/programs endpoint that searches public programs.

Query parameters:
- search: text search on name/description (optional)
- sport: filter by sport type (optional)
- difficulty: filter by difficulty level (optional)
- minWeeks/maxWeeks: filter by duration range (optional)
- page: pagination (default 1)
- limit: items per page (default 20, max 100)

Implementation:
- No auth required (public endpoint)
- Only return programs where isPublic=true
- Include author info (id, name, image)
- Include session count (_count)
- Order by createdAt desc (newest first)
- Return: { programs, total, page, totalPages }
- Use Prisma contains for search (case-insensitive on SQLite)
  </action>
  <verify>curl "http://localhost:3000/api/discover/programs" returns programs array with pagination</verify>
  <done>Programs discovery endpoint returns paginated public programs with filters working</done>
</task>

<task type="auto">
  <name>Task 2: Create sessions discovery endpoint</name>
  <files>src/app/api/discover/sessions/route.ts</files>
  <action>
Create GET /api/discover/sessions endpoint that searches sessions from public users.

Query parameters:
- search: text search on name/description (optional)
- sport: filter by sport type (optional)
- minDuration/maxDuration: filter by estimated duration in minutes (optional)
- page: pagination (default 1)
- limit: items per page (default 20, max 100)

Implementation:
- No auth required (public endpoint)
- Only return sessions where author.isPublic=true
- Include author info (id, name, image)
- Include exercise count (_count)
- Order by createdAt desc
- Return: { sessions, total, page, totalPages }
  </action>
  <verify>curl "http://localhost:3000/api/discover/sessions" returns sessions array with pagination</verify>
  <done>Sessions discovery endpoint returns paginated sessions from public users with filters working</done>
</task>

<task type="auto">
  <name>Task 3: Create users discovery endpoint</name>
  <files>src/app/api/discover/users/route.ts</files>
  <action>
Create GET /api/discover/users endpoint that searches public users.

Query parameters:
- search: text search on name/bio (optional)
- page: pagination (default 1)
- limit: items per page (default 20, max 100)

Implementation:
- No auth required (public endpoint)
- Only return users where isPublic=true
- Return: id, name, image, bio, location
- Include counts: _count for programs (where isPublic=true), followers, following
- Order by follower count desc (most popular first), then by name
- Return: { users, total, page, totalPages }
- If viewer is authenticated, include isFollowing boolean for each user
  </action>
  <verify>curl "http://localhost:3000/api/discover/users" returns users array with pagination and counts</verify>
  <done>Users discovery endpoint returns paginated public users with follower counts</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All three endpoints respond with 200 and valid JSON
- [ ] Pagination works correctly (page, limit, total, totalPages)
- [ ] Search filters work (search param filters results)
- [ ] Sport/difficulty filters work
- [ ] Only public content is returned (isPublic=true)
- [ ] npm run build succeeds
</verification>

<success_criteria>
- All tasks completed
- Three discovery API endpoints functional
- Pagination and filters work correctly
- No private content exposed
</success_criteria>

<output>
After completion, create `.planning/phases/07-discovery/07-01-SUMMARY.md`
</output>

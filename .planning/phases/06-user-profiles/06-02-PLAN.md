---
phase: 06-user-profiles
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified: [src/app/profile/page.tsx, src/app/profile/edit/page.tsx, src/app/users/[id]/page.tsx, src/components/UserCard.tsx, src/components/FollowButton.tsx]
autonomous: false
---

<objective>
Implement User Profiles UI with profile pages and follow system.

Purpose: Allow users to view and edit their profiles, view other users' public profiles, and manage follower/following relationships through the UI.
Output: Profile settings page, public profile pages, and follow/unfollow UI components.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-user-profiles/06-01-SUMMARY.md

@src/app/sessions/page.tsx
@src/components/SessionCard.tsx
@src/components/ProgramCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create UserCard and FollowButton components</name>
  <files>src/components/UserCard.tsx, src/components/FollowButton.tsx</files>
  <action>
Create UserCard component for displaying user in lists (followers/following):
- Props: user (id, name, image, bio), isFollowing?, onFollowChange?
- Display: avatar (or initial if no image), name, bio excerpt (truncated to 100 chars)
- Link to /users/{id} profile page
- Include FollowButton if onFollowChange provided

Create FollowButton component:
- Props: userId, isFollowing (initial state), onFollowChange callback
- "use client" directive for interactivity
- POST /api/users/{id}/follow on click if not following
- DELETE /api/users/{id}/follow on click if following
- Show "Suivre" when not following, "Abonné" when following
- Disable during request, show loading state
- Call onFollowChange after successful toggle

Use existing Tailwind patterns from SessionCard/ProgramCard.
  </action>
  <verify>npm run build succeeds, components export correctly</verify>
  <done>UserCard displays user info with optional follow button, FollowButton toggles follow state via API</done>
</task>

<task type="auto">
  <name>Task 2: Create profile settings page</name>
  <files>src/app/profile/page.tsx, src/app/profile/edit/page.tsx</files>
  <action>
Create /profile page (current user's profile view):
- Requires auth (redirect to /login if not authenticated)
- Fetch from GET /api/profile
- Display: avatar, name, bio, location, member since date
- Show stats: followers count, following count, programs count, sessions count
- Links to: "Modifier le profil", followers list, following list
- Show recent programs and sessions (3 each with "Voir tout" links)

Create /profile/edit page:
- Requires auth
- Form fields: name, bio (textarea, 500 char max with counter), location, isPublic checkbox
- Submit PATCH to /api/profile
- On success, redirect to /profile with success message
- Validate bio length client-side before submit

Follow existing form patterns from sessions/programs create pages.
  </action>
  <verify>npm run build succeeds, /profile shows user data, /profile/edit saves changes</verify>
  <done>Users can view their profile and edit settings</done>
</task>

<task type="auto">
  <name>Task 3: Create public profile page with followers/following tabs</name>
  <files>src/app/users/[id]/page.tsx</files>
  <action>
Create /users/[id] page (public profile view):
- Fetch from GET /api/users/{id}
- If 404 (private profile or not found): show "Profil non trouvé" message
- Display: avatar, name, bio, location, member since
- Show stats: followers, following, public programs count
- FollowButton (if not own profile and authenticated)
- Tabs: "Programmes", "Abonnés", "Abonnements"

Programmes tab (default):
- Grid of user's public programs using ProgramCard
- Empty state if no public programs

Abonnés tab:
- Paginated list of followers using UserCard
- Fetch from GET /api/users/{id}/followers
- "Charger plus" button for pagination

Abonnements tab:
- Paginated list of following using UserCard
- Fetch from GET /api/users/{id}/following
- "Charger plus" button for pagination

Use searchParams for tab state (?tab=followers, ?tab=following).
  </action>
  <verify>npm run build succeeds, /users/{id} displays profile with tabs</verify>
  <done>Public profiles are viewable with programs and follower/following lists</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete user profiles system with profile pages, edit form, public profiles, and follow/unfollow functionality</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/profile (logged in)
    3. Verify: Own profile displays with stats, edit link works
    4. Click "Modifier le profil" and update bio/location
    5. Verify: Changes saved, redirected back to profile
    6. Visit: http://localhost:3000/users/{your-id}
    7. Verify: Public profile shows same data, no follow button on own profile
    8. Create second test user (register new account)
    9. Visit first user's profile from second account
    10. Click "Suivre" button
    11. Verify: Button changes to "Abonné", follower count increases
    12. Click tabs: Programmes, Abonnés, Abonnements
    13. Verify: Each tab shows correct content
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] /profile shows current user's profile with stats
- [ ] /profile/edit allows updating bio, location, name, isPublic
- [ ] /users/{id} shows public profile with programs
- [ ] Follow/unfollow button works and updates UI immediately
- [ ] Followers and following lists paginate correctly
- [ ] Private profiles return 404 to non-owners
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification passed
- No TypeScript errors
- Profile system works end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/06-user-profiles/06-02-SUMMARY.md`
</output>

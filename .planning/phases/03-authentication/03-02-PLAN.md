---
phase: 03-authentication
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified: [src/lib/auth.ts, .env.example, src/app/(auth)/login/page.tsx, src/app/(auth)/register/page.tsx, src/app/api/auth/register/route.ts]
autonomous: false
---

<objective>
Add OAuth providers (Google, GitHub) and create authentication UI (login/register pages).

Purpose: Complete authentication system with multiple sign-in options and user-facing forms.
Output: Working OAuth login, credentials registration, and polished auth pages.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-authentication/03-01-SUMMARY.md

@src/lib/auth.ts
@prisma/schema.prisma
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure OAuth providers (Google, GitHub)</name>
  <files>src/lib/auth.ts, .env.example</files>
  <action>
Update src/lib/auth.ts to add OAuth providers:

1. Import Google and GitHub providers from next-auth/providers
2. Add providers array with:
   - Google({ clientId, clientSecret }) - uses GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET env vars
   - GitHub({ clientId, clientSecret }) - uses GITHUB_CLIENT_ID, GITHUB_CLIENT_SECRET env vars
   - Keep existing Credentials provider

3. Update .env.example with required OAuth environment variables:
   - AUTH_SECRET (required by Auth.js v5)
   - GOOGLE_CLIENT_ID
   - GOOGLE_CLIENT_SECRET
   - GITHUB_CLIENT_ID
   - GITHUB_CLIENT_SECRET

4. Add callbacks if needed for user creation on first OAuth login

Auth.js v5 automatically handles:
- OAuth callback routes (/api/auth/callback/google, /api/auth/callback/github)
- Account linking via Prisma adapter
- Session management
  </action>
  <verify>
- src/lib/auth.ts includes Google and GitHub providers
- .env.example lists all required OAuth variables
- `npm run build` succeeds
  </verify>
  <done>OAuth providers configured, ready for credentials setup</done>
</task>

<task type="auto">
  <name>Task 2: Create registration API endpoint</name>
  <files>src/app/api/auth/register/route.ts</files>
  <action>
Create POST /api/auth/register endpoint for email/password registration:

1. Accept JSON body: { email, password, name? }
2. Validate input:
   - email required, valid email format
   - password required, minimum 8 characters
3. Check if user exists (by email)
4. Hash password with bcryptjs (cost factor 12)
5. Create user in database via Prisma
6. Return 201 with user data (excluding passwordHash)
7. Return appropriate errors:
   - 400 for validation errors
   - 409 for existing email
   - 500 for server errors

Do NOT auto-signin after registration - let user login explicitly for better UX.
  </action>
  <verify>
- curl -X POST /api/auth/register with valid data returns 201
- curl with existing email returns 409
- curl with invalid data returns 400
- Password is hashed in database (not plaintext)
  </verify>
  <done>Registration endpoint creates users with hashed passwords</done>
</task>

<task type="auto">
  <name>Task 3: Create login page with OAuth buttons</name>
  <files>src/app/(auth)/login/page.tsx, src/app/(auth)/layout.tsx</files>
  <action>
Create auth pages using Next.js App Router route groups:

1. Create src/app/(auth)/layout.tsx - minimal centered layout for auth pages
   - Centered card container
   - Tailwind styling consistent with project

2. Create src/app/(auth)/login/page.tsx with:
   - Email/password form using credentials provider
   - "Sign in with Google" button
   - "Sign in with GitHub" button
   - Link to /register
   - Error handling for failed login attempts

Use Auth.js signIn function for form submission:
- signIn("credentials", { email, password, redirectTo: "/dashboard" })
- signIn("google", { redirectTo: "/dashboard" })
- signIn("github", { redirectTo: "/dashboard" })

Form should be a client component ("use client") for interactivity.
Style with Tailwind - clean, minimal design.
  </action>
  <verify>
- /login page renders without errors
- Form inputs work (email, password)
- OAuth buttons present for Google and GitHub
- `npm run build` succeeds
  </verify>
  <done>Login page with credentials form and OAuth buttons</done>
</task>

<task type="auto">
  <name>Task 4: Create registration page</name>
  <files>src/app/(auth)/register/page.tsx</files>
  <action>
Create src/app/(auth)/register/page.tsx with:

1. Registration form:
   - Name input (optional)
   - Email input (required)
   - Password input (required, min 8 chars)
   - Confirm password input
   - Submit button

2. Client-side validation:
   - Email format
   - Password length
   - Password confirmation match

3. Form submission:
   - POST to /api/auth/register
   - On success, redirect to /login with success message
   - On error, display error message

4. Link to /login for existing users

5. OAuth buttons as alternative registration method:
   - "Sign up with Google"
   - "Sign up with GitHub"
   - (OAuth creates account automatically on first login)

Style consistently with login page using Tailwind.
  </action>
  <verify>
- /register page renders without errors
- Form validates inputs client-side
- Successful registration redirects to login
- OAuth buttons present
- `npm run build` succeeds
  </verify>
  <done>Registration page with form and OAuth options</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete authentication system with login/register pages and OAuth providers configured</what-built>
  <how-to-verify>
1. Run: `npm run dev`
2. Visit: http://localhost:3000/login
3. Check login page:
   - Email/password form displays
   - Google and GitHub OAuth buttons visible
   - Link to register page works
4. Visit: http://localhost:3000/register
5. Check registration page:
   - All form fields present (name, email, password, confirm)
   - Validation works (try submitting empty)
   - OAuth buttons visible
6. Test registration flow:
   - Fill valid data, submit
   - Check user created in database (or redirect to login)
7. Test credentials login (if user exists):
   - Enter email/password
   - Should redirect to /dashboard (or show error if invalid)

Note: OAuth login requires actual Google/GitHub credentials configured. You can verify the buttons and routes exist without testing actual OAuth flow.
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] OAuth providers (Google, GitHub) configured in auth.ts
- [ ] Registration API creates users with hashed passwords
- [ ] Login page has credentials form + OAuth buttons
- [ ] Register page has form + OAuth buttons
- [ ] Visual verification passed
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verified auth UI works correctly
- Complete auth flow functional (register -> login -> dashboard)
</success_criteria>

<output>
After completion, create `.planning/phases/03-authentication/03-02-SUMMARY.md`
</output>

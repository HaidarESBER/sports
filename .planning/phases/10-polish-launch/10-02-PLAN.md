---
phase: 10-polish-launch
plan: 02
type: execute
wave: 1
depends_on: [10-01]
files_modified: [next.config.ts, src/app/layout.tsx, src/lib/metadata.ts, src/app/not-found.tsx, src/app/error.tsx, src/app/loading.tsx, src/components/ErrorBoundary.tsx, .env.example, .env.local]
autonomous: false
---

<objective>
Optimize performance, add SEO metadata, error handling, and prepare for production deployment.

Purpose: Ensure the application is production-ready with proper SEO, error handling, performance optimizations, and deployment configuration.
Output: Optimized Next.js config, SEO metadata, error pages, and production environment setup
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@next.config.ts
@src/app/layout.tsx
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Next.js for production</name>
  <files>next.config.ts</files>
  <action>
Update Next.js configuration with production optimizations.

Additions:
- Enable image optimization:
  - Configure remotePatterns for external images (avatars, etc.)
  - Set deviceSizes and imageSizes for responsive images
- Configure headers for security:
  - X-DNS-Prefetch-Control
  - X-Frame-Options: DENY
  - X-Content-Type-Options: nosniff
  - Referrer-Policy: origin-when-cross-origin
- Enable compression (default in production)
- Configure powered by header removal
- Add redirects if needed (e.g., /home -> /)
- Configure trailing slash behavior (remove trailing slashes)

Optional performance configs:
- Enable experimental optimizations if stable
  </action>
  <verify>npm run build succeeds with new config</verify>
  <done>Next.js configured for production deployment</done>
</task>

<task type="auto">
  <name>Task 2: Create SEO metadata utilities</name>
  <files>src/lib/metadata.ts, src/app/layout.tsx</files>
  <action>
Create centralized metadata configuration for SEO.

src/lib/metadata.ts:
- Export base metadata object:
  - title: "SportPlan - Planifiez, Partagez, Progressez"
  - description: SEO-friendly description
  - keywords: sport, entrainement, programme, seance, etc.
  - openGraph: title, description, images, locale
  - twitter: card type, title, description
  - robots: index, follow
  - viewport: width=device-width, initial-scale=1
- Export generateMetadata helper function for dynamic pages
- Define site URL constant (from env or default)

src/app/layout.tsx updates:
- Import and use base metadata
- Add manifest link (for PWA potential)
- Add theme-color meta tag
- Add canonical URL
  </action>
  <verify>View page source shows proper meta tags</verify>
  <done>SEO metadata configured for all pages</done>
</task>

<task type="auto">
  <name>Task 3: Create custom error pages</name>
  <files>src/app/not-found.tsx, src/app/error.tsx, src/app/loading.tsx</files>
  <action>
Create custom error and loading pages for better UX.

not-found.tsx (404 page):
- Friendly message: "Page non trouvee"
- Icon or illustration
- Link back to home page
- Consistent styling with brand

error.tsx (global error boundary):
- Client component with reset functionality
- Display error message (generic for users)
- "Reessayer" button to reset error boundary
- "Retour a l'accueil" link
- Log error to console (production would send to monitoring)

loading.tsx (global loading):
- Full-page loading spinner
- Use LoadingSpinner component from 10-01
- Centered layout with subtle animation
  </action>
  <verify>Error pages render correctly when triggered</verify>
  <done>Custom error and loading pages created</done>
</task>

<task type="auto">
  <name>Task 4: Create ErrorBoundary component</name>
  <files>src/components/ErrorBoundary.tsx</files>
  <action>
Create a reusable client-side error boundary component.

Features:
- Wrap any component to catch errors
- Props:
  - children: React.ReactNode
  - fallback?: React.ReactNode (custom fallback UI)
  - onError?: (error: Error) => void (callback for logging)
- Default fallback: styled error message with retry button
- Reset state when children change

Use React's error boundary pattern with class component or the new use API if available.
  </action>
  <verify>Component catches errors and displays fallback</verify>
  <done>Reusable ErrorBoundary component ready</done>
</task>

<task type="auto">
  <name>Task 5: Create environment configuration</name>
  <files>.env.example</files>
  <action>
Create environment variable template for deployment.

.env.example contents:
```
# Database
DATABASE_URL="file:./dev.db"

# Authentication
AUTH_SECRET="your-auth-secret-here"
NEXTAUTH_URL="http://localhost:3000"

# Optional: External services (for future use)
# SMTP_HOST=""
# SMTP_PORT=""
# SMTP_USER=""
# SMTP_PASS=""

# Optional: Analytics (for future use)
# ANALYTICS_ID=""

# Environment
NODE_ENV="development"
```

Document each variable with comments explaining:
- What it's for
- Example value or format
- Whether it's required or optional
  </action>
  <verify>.env.example file exists with all required variables</verify>
  <done>Environment template created for deployment</done>
</task>

<task type="auto">
  <name>Task 6: Add performance optimizations to components</name>
  <files>src/components/ProgramCard.tsx, src/components/SessionCard.tsx</files>
  <action>
Add performance optimizations to existing components.

Optimizations:
- Memoize components with React.memo where appropriate
- Ensure event handlers use useCallback
- Add loading="lazy" to any images
- Use CSS containment for card layouts (contain: content)

Review and add to existing cards:
- ProgramCard: memo, optimize re-renders
- SessionCard: memo, optimize re-renders
- UserCard: memo if exists

Add CSS class for card animation:
- Subtle fade-in on mount
- Smooth hover transition (already exists but verify)
  </action>
  <verify>Components render efficiently, no unnecessary re-renders</verify>
  <done>Performance optimizations applied to key components</done>
</task>

<task type="auto">
  <name>Task 7: Final build verification</name>
  <files></files>
  <action>
Run final production build and verify everything works.

Steps:
1. Run: npm run build
2. Check for any TypeScript errors
3. Check for any ESLint warnings
4. Run: npm run start (production mode)
5. Test key flows:
   - Landing page loads
   - Navigation works
   - Auth flow works
   - Sessions/Programs CRUD
   - Discovery page
6. Check bundle size in .next/analyze (if enabled)

Fix any issues found during verification.
  </action>
  <verify>npm run build && npm run start both succeed</verify>
  <done>Production build verified and working</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Production-ready configuration with SEO, error handling, and optimizations</what-built>
  <how-to-verify>
    1. Run: npm run build (should complete without errors)
    2. Run: npm run start
    3. Test in browser:
       - Check page source for SEO meta tags
       - Test 404 page: visit /nonexistent-page
       - Test error recovery (if possible to trigger)
       - Check loading states on slow network (DevTools)
    4. Security headers:
       - Open DevTools > Network > Check response headers
       - Verify X-Frame-Options, X-Content-Type-Options present
    5. Performance:
       - Run Lighthouse audit in Chrome DevTools
       - Check for any major issues (aim for 80+ scores)
    6. Mobile testing:
       - Test on actual mobile device or emulator
       - Verify responsive design works
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] npm run start runs production server correctly
- [ ] SEO meta tags present on all pages
- [ ] 404 page displays correctly
- [ ] Error boundary catches and displays errors gracefully
- [ ] Loading states work correctly
- [ ] Security headers configured
- [ ] .env.example documents all required variables
- [ ] User approved production verification
</verification>

<success_criteria>
- All tasks completed
- Production build working without errors
- SEO properly configured
- Error handling graceful and user-friendly
- Performance optimizations applied
- Ready for deployment
- User approved the implementation
</success_criteria>

<output>
After completion, create `.planning/phases/10-polish-launch/10-02-SUMMARY.md`
</output>

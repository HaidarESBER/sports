---
phase: 05-programs-core
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified: [src/app/programs/page.tsx, src/app/programs/new/page.tsx, src/app/programs/[id]/page.tsx, src/app/programs/[id]/edit/page.tsx, src/app/programs/[id]/DeleteProgramButton.tsx, src/components/ProgramCard.tsx, src/components/SessionScheduler.tsx]
autonomous: false
---

<objective>
Create complete user interface for Programs management with calendar-based session scheduling.

Purpose: Enable users to create, view, edit and delete training programs with visual week/day session placement.
Output: Programs pages with list, create, detail, edit views and SessionScheduler component.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior patterns to follow
@.planning/phases/04-sessions-core/04-02-SUMMARY.md

# API endpoints (from 05-01)
@.planning/phases/05-programs-core/05-01-SUMMARY.md

# UI patterns to follow
@src/app/sessions/page.tsx
@src/app/sessions/new/page.tsx
@src/app/sessions/[id]/page.tsx
@src/components/SessionCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Programs list page and ProgramCard component</name>
  <files>src/app/programs/page.tsx, src/components/ProgramCard.tsx</files>
  <action>
**ProgramCard component (src/components/ProgramCard.tsx):**
- Displays: name, sport badge, durationWeeks (e.g., "8 semaines"), difficulty badge, description preview
- Shows session count (total sessions in program)
- isPublic indicator (small icon/badge if public)
- Link to /programs/[id]
- Tailwind styling matching SessionCard aesthetic

**Programs list page (src/app/programs/page.tsx):**
- Server component that fetches programs directly via Prisma
- Auth check: redirect to /login if not authenticated
- Sport filter tabs (same as sessions: all, running, swimming, cycling, strength, other)
- Grid layout with ProgramCard components
- Empty state with CTA to create first program
- Header with "Mes Programmes" title and "Nouveau programme" button

Follow exact patterns from src/app/sessions/page.tsx:
- Same sportFilters array
- Same searchParams handling for sport filter
- Same redirect pattern for auth
- Same grid/empty state structure
  </action>
  <verify>npm run build succeeds without errors</verify>
  <done>Programs list displays user's programs with sport filtering and empty state</done>
</task>

<task type="auto">
  <name>Task 2: Create SessionScheduler component</name>
  <files>src/components/SessionScheduler.tsx</files>
  <action>
Create a visual week/day grid for scheduling sessions into a program:

**SessionScheduler component:**
- Props:
  ```typescript
  interface ScheduledSession {
    sessionId: string
    sessionName: string  // for display
    weekNumber: number
    dayOfWeek: number
    order: number
  }

  interface SessionSchedulerProps {
    durationWeeks: number
    scheduledSessions: ScheduledSession[]
    onScheduleChange: (sessions: ScheduledSession[]) => void
    availableSessions: { id: string; name: string; sport: string }[]
  }
  ```

- Visual layout:
  - Header row: Lun, Mar, Mer, Jeu, Ven, Sam, Dim
  - One row per week (1 to durationWeeks)
  - Each cell shows scheduled sessions for that week/day
  - Click cell to open modal/dropdown to add session from availableSessions
  - Click existing session chip to remove it

- Simple implementation (no drag-drop for v1):
  - Cell click opens a dropdown with user's sessions (filter by sport if program.sport set)
  - Select session adds it to that week/day
  - X button on session chip removes it
  - Multiple sessions per day supported (stacked vertically)

- State management:
  - Maintain local state of scheduled sessions
  - Call onScheduleChange whenever sessions array changes

Use Tailwind for styling:
- Grid with fixed column widths
- Week numbers on left side (Semaine 1, Semaine 2...)
- Cells have light border, hover state
- Session chips with session name, small remove button
  </action>
  <verify>npm run build succeeds without errors</verify>
  <done>SessionScheduler renders week/day grid and allows adding/removing sessions</done>
</task>

<task type="auto">
  <name>Task 3: Create Program create and edit forms</name>
  <files>src/app/programs/new/page.tsx, src/app/programs/[id]/edit/page.tsx</files>
  <action>
**New Program page (src/app/programs/new/page.tsx):**
- Client component ("use client")
- Form fields:
  - name (required)
  - sport (required, same dropdown as sessions)
  - description (optional, textarea)
  - durationWeeks (required, number input, min 1, max 52)
  - difficulty (optional, select: debutant, intermediaire, avance)
  - isPublic (checkbox, default false)
- Fetch user's sessions for SessionScheduler (GET /api/sessions)
- Include SessionScheduler for initial session placement
- Submit flow:
  1. POST /api/programs to create program
  2. If sessions scheduled, PUT /api/programs/[id]/sessions to save schedule
  3. Redirect to /programs/[id]

**Edit Program page (src/app/programs/[id]/edit/page.tsx):**
- Client component
- Fetch existing program (GET /api/programs/[id]) on mount
- Pre-populate form with existing values
- SessionScheduler shows existing schedule
- Submit: PUT /api/programs/[id] then PUT /api/programs/[id]/sessions
- Include link to delete (separate component in next task)

Follow patterns from src/app/sessions/new/page.tsx and src/app/sessions/[id]/edit/page.tsx:
- Same form structure and styling
- Same error handling pattern
- Same "Retour" link styling
  </action>
  <verify>npm run build succeeds without errors</verify>
  <done>Create and edit forms work with SessionScheduler for session placement</done>
</task>

<task type="auto">
  <name>Task 4: Create Program detail page and delete functionality</name>
  <files>src/app/programs/[id]/page.tsx, src/app/programs/[id]/DeleteProgramButton.tsx</files>
  <action>
**Program detail page (src/app/programs/[id]/page.tsx):**
- Server component
- Auth check, redirect to /login if not authenticated
- Fetch program with sessions via Prisma directly
- Ownership check: redirect to /programs if not owner
- Display:
  - Program name, sport badge, difficulty badge
  - Duration: "Programme de X semaines"
  - Public/Private indicator
  - Description
  - Calendar view of scheduled sessions (read-only):
    - Week/day grid showing session names
    - Click session to go to /sessions/[sessionId]
  - Edit and Delete buttons

**DeleteProgramButton (src/app/programs/[id]/DeleteProgramButton.tsx):**
- Client component
- Confirmation dialog (same pattern as DeleteSessionButton)
- DELETE /api/programs/[id]
- Redirect to /programs on success

Follow patterns from src/app/sessions/[id]/page.tsx and DeleteSessionButton.tsx
  </action>
  <verify>npm run build succeeds without errors</verify>
  <done>Program detail page shows calendar view with edit/delete actions</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Programs management UI with calendar-based session scheduling</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Login and navigate to /programs
    3. Verify empty state shows "Aucun programme" with create button
    4. Create a new program:
       - Fill name, sport, duration (e.g., 4 weeks), difficulty
       - Use SessionScheduler to place sessions on different days
       - Submit and verify redirect to detail page
    5. View program detail:
       - Verify calendar shows scheduled sessions
       - Click session name to verify link to session detail
    6. Edit program:
       - Modify fields and session schedule
       - Verify changes persist
    7. Delete program:
       - Confirm deletion dialog appears
       - Verify redirect to /programs list
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Programs list page works with sport filtering
- [ ] SessionScheduler allows visual session placement
- [ ] Create/edit forms work end-to-end
- [ ] Detail page shows calendar view
- [ ] Delete with confirmation works
- [ ] User verified UI functionality
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- User approved UI functionality
- Programs CRUD works end-to-end with session scheduling
</success_criteria>

<output>
After completion, create `.planning/phases/05-programs-core/05-02-SUMMARY.md`
</output>
